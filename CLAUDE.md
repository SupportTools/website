# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This repository contains the codebase for Support Tools website (support.tools), which consists of:

1. A Hugo-based blog for content generation
2. A custom Go web server that serves the static content
3. Kubernetes deployment configuration for multiple environments

## Project Architecture

### Web Server Component
- Written in Go, the server serves static content generated by Hugo
- Has two serving modes:
  - Direct filesystem serving
  - In-memory serving (for performance)
- Implements Prometheus metrics for monitoring
- Provides health endpoints for Kubernetes readiness/liveness probes

### Hugo Blog Component
- Uses the m10c theme
- Content is organized into multiple sections:
  - Blog posts
  - Training materials
  - Known good designs
  - About/certificates/publications

### Deployment Architecture
- Uses Docker multi-stage builds:
  1. Hugo stage: Builds the static site
  2. Go builder stage: Compiles the Go server
  3. Runtime stage: Packages both into a final image
- Kubernetes deployment via Helm charts
- Multiple deployment environments (dev, qas, tst, stg, prd)
- CDN synchronization for production environments

## Development Workflow

### Local Development

To run the Hugo development server locally:

```bash
make dev
```

This starts a Hugo server at http://localhost:1313 with live reloading.

### Building Docker Images

To build the Docker image with a specific tag:

```bash
make build tag=X.Y.Z
```

To build and push the Docker image:

```bash
make all tag=X.Y.Z
```

Or for shorthand:

```bash
make bump tag=X.Y.Z
```

### Deployment

The deployment process is handled by `deploy.sh` which:
1. Sets up the appropriate Kubernetes context
2. Creates/updates namespaces with proper labels
3. Deploys the application via Helm charts
4. Configures autoscaling based on environment

Deploy to a specific environment:

```bash
./deploy.sh [dev|qas|tst|stg|prd]
```

## Environment Variables

The application can be configured with the following environment variables:

- `DEBUG`: Enable debug logging (default: false)
- `PORT`: HTTP port for the main web server (default: 8080) 
- `METRICS_PORT`: Port for Prometheus metrics (default: 9090)
- `WEBROOT`: Root directory for static files (default: /app/public)
- `USE_MEMORY`: Load files into memory for faster serving (default: false)
- `LOG_FILE_PATH`: Path to access log file (default: /var/log/access.log)

## Helm Chart Configuration

The Helm chart for deployment supports these key values:

- `image.tag`: Docker image tag to deploy
- `ingress.host`: Hostname for the Ingress resource
- `autoscaling.minReplicas`: Minimum pod replicas
- `autoscaling.maxReplicas`: Maximum pod replicas 
- `webcache.replicaCount`: Number of web cache replicas

## Adding New Blog Content

New blog posts should be added to the `blog/content/post/` directory using the Markdown format with appropriate frontmatter.

## Blog Writing Guidelines

When creating blog content:

1. Follow the template in `blog/_template.md` exactly, including frontmatter structure
2. Use appropriate tags and categories based on content topics
3. Create relevant SEO-friendly titles, descriptions, and keywords
4. Maintain a highly technical writing style that demonstrates expertise
5. Use future dates for posts, with more recent dates for version updates or news
6. Place featured images at the top of posts when applicable
7. Ensure URLs match the content topic and are SEO-friendly
8. Include code examples, command snippets, and technical details where relevant
9. Structure content with clear sections and hierarchical headings